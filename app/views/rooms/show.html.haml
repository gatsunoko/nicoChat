- content_for :header do
  .link
    %a{href: "javascript:history.back();", class: 'back_link', id: 'back_button'} <
  .link
    = link_to 'Edit', edit_room_path(@room)
  .title
    %h3
      = @room.title
</div>
.room_show
  .messages#messages
    - @messages.each do |message|
      = render 'message', message: message
  .input_area
    %form
      %input{type: "text", 'data-behavior' => "room_speaker", class: 'text_box'}
  :javascript
    (function() {
      App.room1 = App.cable.subscriptions.create({
        channel: 'RoomChannel',
        room: #{@room.id}  // channelに送られた後、params['room']で取り出せる
      }, {
        connected: function() {
        },
        disconnected: function() {
        },
        received: function(data) {
          $('#messages').append(data['message']);
          $('#messages').animate({scrollTop: $('#messages')[0].scrollHeight}, 'fast');
          return
        },
        speak: function(message, room_id) {
          return this.perform('speak', {
            message: message,
          });
        }
      });

      $(document).on('keypress', '[data-behavior~=room_speaker]', function(event) {
        if (event.keyCode === 13) {
          App.room1.speak(event.target.value, #{@room.id});
          event.target.value = '';
          return event.preventDefault();
        }
      });
    })();